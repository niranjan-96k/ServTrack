<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ServTrack - Job Controller Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: #f0f2f5;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }

        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #1a73e8;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .login-container {
            background: white;
            border-radius: 20px;
            padding: 60px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            text-align: center;
            width: 90%;
            max-width: 500px;
        }

        .login-logo {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .login-title {
            font-size: 28px;
            color: #333;
            margin-bottom: 10px;
        }

        .login-subtitle {
            font-size: 18px;
            color: #666;
            margin-bottom: 40px;
        }

        .pin-input-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
        }

        .pin-digit {
            width: 70px;
            height: 80px;
            font-size: 32px;
            text-align: center;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            outline: none;
            transition: all 0.2s;
        }

        .pin-digit:focus {
            border-color: #1a73e8;
            transform: scale(1.05);
        }

        .pin-digit.filled {
            background: #e8f0fe;
            border-color: #1a73e8;
        }

        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            max-width: 300px;
            margin: 0 auto;
        }

        .keypad-btn {
            width: 80px;
            height: 80px;
            font-size: 28px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .keypad-btn:active {
            background: #e8f0fe;
            transform: scale(0.95);
        }

        .keypad-btn.delete {
            grid-column: span 2;
            width: auto;
            background: #f44336;
            color: white;
            border-color: #f44336;
        }

        .login-error {
            color: #d32f2f;
            margin-top: 20px;
            font-size: 16px;
            min-height: 24px;
        }

        .login-screen.hidden {
            display: none;
        }

        /* Main App */
        .app-container {
            display: flex;
            height: 100vh;
            background: #f0f2f5;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: #1a73e8;
            color: white;
            display: flex;
            align-items: center;
            padding: 0 20px;
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 24px;
            font-weight: 500;
            flex: 1;
        }

        .header-stats {
            display: flex;
            gap: 40px;
            align-items: center;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 600;
        }

        .stat-value.alert {
            color: #ffeb3b;
        }

        .stat-label {
            font-size: 13px;
            opacity: 0.9;
        }

        .logout-btn {
            margin-left: 30px;
            padding: 10px 20px;
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        /* Main Content */
        .main-content {
            display: flex;
            flex: 1;
            margin-top: 70px;
            gap: 20px;
            padding: 20px;
        }

        /* Queue Panel */
        .queue-panel {
            width: 380px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }

        .queue-header {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .queue-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .pending-count {
            background: #ea4335;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 16px;
        }

        .queue-subtitle {
            font-size: 14px;
            color: #666;
        }

        .queue-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .vehicle-card {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: grab;
            transition: all 0.2s;
            position: relative;
        }

        .vehicle-card:active {
            cursor: grabbing;
        }

        .vehicle-card.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }

        .vehicle-card:hover {
            border-color: #1a73e8;
            box-shadow: 0 2px 8px rgba(26, 115, 232, 0.2);
        }

        .vehicle-card.priority {
            border-left: 5px solid #ea4335;
        }

        .vehicle-card.waiting-customer {
            border-left: 5px solid #fbbc04;
        }

        .vehicle-card.running-late {
            background: #ffebee;
            border-color: #f44336;
        }

        .vehicle-card.vip {
            background: linear-gradient(135deg, #f8f9fa 0%, #f3e5f5 100%);
            border: 2px solid #ab47bc;
        }

        .vehicle-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .vehicle-number {
            font-size: 18px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .wait-time {
            font-size: 14px;
            color: #666;
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .wait-time.late {
            background: #ffcdd2;
            color: #c62828;
        }

        .vehicle-details {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .detail-chip {
            font-size: 12px;
            padding: 4px 8px;
            background: #e8f0fe;
            color: #1967d2;
            border-radius: 4px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .detail-chip.skill-required {
            background: #fef7e0;
            color: #b55e00;
        }

        .priority-tags {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .priority-tag {
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .priority-tag.rr {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ef5350;
        }

        .priority-tag.cw {
            background: #fff3e0;
            color: #f57c00;
            border: 1px solid #ff9800;
        }

        .priority-tag.vip {
            background: #f3e5f5;
            color: #6a1b9a;
            border: 1px solid #ab47bc;
        }

        .job-card-info {
            font-size: 13px;
            color: #666;
            border-top: 1px solid #e0e0e0;
            padding-top: 10px;
            margin-top: 10px;
        }

        .job-card-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .job-card-link {
            color: #1a73e8;
            text-decoration: none;
            cursor: pointer;
        }

        .job-card-link:hover {
            text-decoration: underline;
        }

        .demanded-repairs {
            margin-top: 8px;
            font-size: 12px;
            color: #666;
            background: #f5f5f5;
            padding: 8px;
            border-radius: 4px;
        }

        /* Bay Grid and Timeline Container */
        .main-view-container {
            flex: 1;
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .view-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .view-title {
            font-size: 22px;
            font-weight: 600;
        }

        .view-toggle {
            display: flex;
            gap: 10px;
        }

        .view-btn {
            padding: 10px 20px;
            border: 1px solid #e0e0e0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .view-btn.active {
            background: #1a73e8;
            color: white;
            border-color: #1a73e8;
        }

        /* Bay Grid View */
        .bay-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            flex: 1;
            overflow-y: auto;
        }

        .bay-grid.hidden {
            display: none;
        }

        .bay-card {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            min-height: 180px;
            position: relative;
            transition: all 0.2s;
            cursor: pointer;
        }

        .bay-card.empty {
            background: #e8f5e9;
            border-color: #4caf50;
            border-style: dashed;
        }

        .bay-card.occupied {
            background: #fff3e0;
            border-color: #ff9800;
        }

        .bay-card.finishing-soon {
            background: #e3f2fd;
            border-color: #2196f3;
            animation: pulse 2s infinite;
        }

        .bay-card.needs-attention {
            background: #ffebee;
            border-color: #f44336;
            box-shadow: 0 0 10px rgba(244, 67, 54, 0.3);
        }

        @keyframes pulse {
            0% { border-color: #2196f3; }
            50% { border-color: #1976d2; }
            100% { border-color: #2196f3; }
        }

        .bay-card.drag-over {
            background: #c8e6c9;
            border-color: #4caf50;
            transform: scale(1.02);
        }

        .bay-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .bay-number {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .bay-status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4caf50;
        }

        .bay-status-indicator.occupied {
            background: #ff9800;
        }

        .bay-status-indicator.alert {
            background: #f44336;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .bay-content {
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .bay-vehicle {
            width: 100%;
        }

        .bay-vehicle .vehicle-number {
            font-size: 16px;
            text-align: center;
            margin-bottom: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            background: #4caf50;
            transition: width 0.3s;
        }

        .progress-fill.warning {
            background: #ff9800;
        }

        .progress-fill.alert {
            background: #f44336;
        }

        .time-info {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: #666;
        }

        .empty-state {
            color: #999;
            font-size: 14px;
            text-align: center;
        }

        .recommended-vehicles {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #e0e0e0;
            font-size: 12px;
            color: #666;
        }

        /* Timeline View */
        .timeline-view {
            flex: 1;
            overflow: auto;
            display: none;
        }

        .timeline-view.active {
            display: block;
        }

        .timeline-header {
            display: grid;
            grid-template-columns: 100px 1fr;
            background: #f5f5f5;
            border-bottom: 2px solid #e0e0e0;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .timeline-bay-label {
            padding: 10px;
            font-weight: 600;
            border-right: 1px solid #e0e0e0;
        }

        .timeline-hours {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
        }

        .hour-label {
            padding: 10px 5px;
            text-align: center;
            font-size: 13px;
            border-right: 1px solid #e0e0e0;
        }

        .timeline-body {
            display: grid;
            grid-template-columns: 100px 1fr;
        }

        .timeline-row {
            display: contents;
        }

        .bay-label {
            padding: 20px 10px;
            background: #fafafa;
            border-right: 1px solid #e0e0e0;
            border-bottom: 1px solid #e0e0e0;
            font-weight: 500;
        }

        .timeline-slots {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            border-bottom: 1px solid #e0e0e0;
            position: relative;
            min-height: 60px;
        }

        .timeline-slot {
            border-right: 1px solid #f0f0f0;
            position: relative;
        }

        .timeline-vehicle {
            position: absolute;
            top: 5px;
            bottom: 5px;
            background: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 6px;
            padding: 5px;
            font-size: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s;
            z-index: 1;
        }

        .timeline-vehicle:hover {
            transform: scale(1.02);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            z-index: 2;
        }

        .timeline-vehicle.late {
            background: #ffebee;
            border-color: #f44336;
        }

        .timeline-vehicle.finishing {
            background: #e8f5e9;
            border-color: #4caf50;
        }

        .current-time-indicator {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #ea4335;
            z-index: 5;
            pointer-events: none;
        }

        .current-time-indicator::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -4px;
            width: 10px;
            height: 10px;
            background: #ea4335;
            border-radius: 50%;
        }

        /* Alerts Panel */
        .alerts-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            max-height: 400px;
            z-index: 90;
        }

        .alert-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            border-left: 4px solid #ea4335;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .alert-item.warning {
            border-left-color: #fbbc04;
        }

        .alert-item.info {
            border-left-color: #4285f4;
        }

        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .alert-title {
            font-weight: 600;
            font-size: 14px;
        }

        .alert-close {
            cursor: pointer;
            font-size: 18px;
            color: #999;
            line-height: 1;
        }

        .alert-message {
            font-size: 13px;
            color: #666;
            margin-bottom: 10px;
        }

        .alert-actions {
            display: flex;
            gap: 10px;
        }

        .alert-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .alert-btn.primary {
            background: #1a73e8;
            color: white;
        }

        .alert-btn.primary:hover {
            background: #1557b0;
        }

        .alert-btn.secondary {
            background: #f0f0f0;
            color: #666;
        }

        /* Modals */
        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            z-index: 200;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            display: none;
        }

        .modal.active {
            display: block;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 190;
            display: none;
        }

        .modal-overlay.active {
            display: block;
        }

        .modal-header {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-close-btn {
            cursor: pointer;
            font-size: 24px;
            color: #999;
            line-height: 1;
            transition: color 0.2s;
        }

        .modal-close-btn:hover {
            color: #666;
        }

        /* Vehicle Details Modal */
        .vehicle-detail-section {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .vehicle-detail-section:last-child {
            border-bottom: none;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            font-size: 15px;
        }

        .detail-label {
            color: #666;
            font-weight: 500;
        }

        .detail-value {
            color: #333;
            font-weight: 600;
        }

        .priority-tags {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .priority-tag {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .priority-tag.rr {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ef5350;
        }

        .priority-tag.cw {
            background: #fff3e0;
            color: #f57c00;
            border: 1px solid #ff9800;
        }

        .priority-tag.vip {
            background: #f3e5f5;
            color: #6a1b9a;
            border: 1px solid #ab47bc;
        }

        .progress-section {
            margin-top: 20px;
        }

        .large-progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .large-progress-fill {
            height: 100%;
            background: #4caf50;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            font-weight: 600;
        }

        .recommendation-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .recommendation-item {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .recommendation-item:hover {
            border-color: #1a73e8;
            background: #f8f9fa;
        }

        .recommendation-item.best {
            border-color: #4caf50;
            background: #e8f5e9;
        }

        .recommendation-score {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .score-badge {
            background: #4caf50;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            white-space: nowrap;
        }

        .recommendation-details {
            font-size: 13px;
            color: #666;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .queue-panel {
                width: 320px;
            }
            .bay-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-container">
            <div class="login-logo">🏭</div>
            <h1 class="login-title">Job Controller Login</h1>
            <p class="login-subtitle">Enter your 4-digit PIN</p>
            
            <div class="pin-input-container">
                <input type="password" class="pin-digit" maxlength="1" readonly>
                <input type="password" class="pin-digit" maxlength="1" readonly>
                <input type="password" class="pin-digit" maxlength="1" readonly>
                <input type="password" class="pin-digit" maxlength="1" readonly>
            </div>
            
            <div class="keypad">
                <button class="keypad-btn" onclick="addDigit('1')">1</button>
                <button class="keypad-btn" onclick="addDigit('2')">2</button>
                <button class="keypad-btn" onclick="addDigit('3')">3</button>
                <button class="keypad-btn" onclick="addDigit('4')">4</button>
                <button class="keypad-btn" onclick="addDigit('5')">5</button>
                <button class="keypad-btn" onclick="addDigit('6')">6</button>
                <button class="keypad-btn" onclick="addDigit('7')">7</button>
                <button class="keypad-btn" onclick="addDigit('8')">8</button>
                <button class="keypad-btn" onclick="addDigit('9')">9</button>
                <button class="keypad-btn delete" onclick="clearPin()">Clear</button>
                <button class="keypad-btn" onclick="addDigit('0')">0</button>
            </div>
            
            <div class="login-error" id="loginError"></div>
        </div>
    </div>

    <!-- Main App -->
    <div class="app-container" style="display: none;" id="mainApp">
        <!-- Header -->
        <header class="header">
            <h1>Job Controller Dashboard - Wonder Cars Workshop</h1>
            <div class="header-stats">
                <div class="stat-item">
                    <div class="stat-value" id="vehiclesInShop">47</div>
                    <div class="stat-label">In Workshop</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="pendingVehicles">12</div>
                    <div class="stat-label">Pending</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value alert" id="needsAttention">3</div>
                    <div class="stat-label">Need Attention</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="baysUtilization">78%</div>
                    <div class="stat-label">Bay Utilization</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="currentTime">10:32 AM</div>
                    <div class="stat-label">Current Time</div>
                </div>
            </div>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Queue Panel -->
            <div class="queue-panel">
                <div class="queue-header">
                    <h2 class="queue-title">
                        Vehicle Queue
                        <span class="pending-count" id="queueCount">12</span>
                    </h2>
                    <div class="queue-subtitle">Drag to allocate to bay</div>
                </div>
                <div class="queue-list" id="queueList">
                    <!-- Vehicle cards will be dynamically added here -->
                </div>
            </div>

            <!-- Main View Container -->
            <div class="main-view-container">
                <div class="view-header">
                    <h2 class="view-title">Workshop Bays</h2>
                    <div class="view-toggle">
                        <button class="view-btn active" onclick="setView('grid')">Grid View</button>
                        <button class="view-btn" onclick="setView('timeline')">Timeline View</button>
                    </div>
                </div>
                
                <!-- Bay Grid View -->
                <div class="bay-grid" id="bayGrid">
                    <!-- Bay cards will be dynamically added here -->
                </div>
                
                <!-- Timeline View -->
                <div class="timeline-view" id="timelineView">
                    <div class="timeline-header">
                        <div class="timeline-bay-label">Bay</div>
                        <div class="timeline-hours">
                            <div class="hour-label">8 AM</div>
                            <div class="hour-label">9 AM</div>
                            <div class="hour-label">10 AM</div>
                            <div class="hour-label">11 AM</div>
                            <div class="hour-label">12 PM</div>
                            <div class="hour-label">1 PM</div>
                            <div class="hour-label">2 PM</div>
                            <div class="hour-label">3 PM</div>
                            <div class="hour-label">4 PM</div>
                            <div class="hour-label">5 PM</div>
                            <div class="hour-label">6 PM</div>
                            <div class="hour-label">7 PM</div>
                        </div>
                    </div>
                    <div class="timeline-body" id="timelineBody">
                        <!-- Timeline rows will be dynamically added here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Alerts Panel -->
        <div class="alerts-panel" id="alertsPanel">
            <!-- Alerts will be dynamically added here -->
        </div>
        
        <!-- Modals -->
        <div class="modal-overlay" id="modalOverlay" onclick="closeModal()"></div>
        
        <!-- Recommendation Modal -->
        <div class="modal" id="recommendationModal">
            <h3 class="modal-header">
                <span>Recommended Vehicles for <span id="modalBayNumber"></span></span>
                <span class="modal-close-btn" onclick="closeModal()">&times;</span>
            </h3>
            <div class="recommendation-list" id="recommendationList">
                <!-- Recommendations will be dynamically added here -->
            </div>
        </div>
        
        <!-- Vehicle Details Modal -->
        <div class="modal" id="vehicleDetailsModal">
            <h3 class="modal-header">
                <span>Vehicle Details - <span id="modalVehicleNumber"></span></span>
                <span class="modal-close-btn" onclick="closeModal()">&times;</span>
            </h3>
            <div class="priority-tags" id="modalPriorityTags">
                <!-- Priority tags will be added here -->
            </div>
            
            <div class="vehicle-detail-section">
                <div class="detail-row">
                    <span class="detail-label">Job Card No:</span>
                    <span class="detail-value"><a href="#" class="job-card-link" id="modalJobCard">JC-2024-1001</a></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Service Type:</span>
                    <span class="detail-value" id="modalServiceType">Paid Service</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Service Advisor:</span>
                    <span class="detail-value" id="modalAdvisor">Rajesh Kumar</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Bay Number:</span>
                    <span class="detail-value" id="modalBay">Bay 1</span>
                </div>
            </div>
            
            <div class="vehicle-detail-section">
                <div class="detail-row">
                    <span class="detail-label">Start Time:</span>
                    <span class="detail-value" id="modalStartTime">9:00 AM</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Estimated Delivery:</span>
                    <span class="detail-value" id="modalEstDelivery">2:30 PM</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Time Remaining:</span>
                    <span class="detail-value" id="modalTimeRemaining">45 minutes</span>
                </div>
            </div>
            
            <div class="vehicle-detail-section">
                <h4 style="margin-bottom: 10px;">Demanded Repairs:</h4>
                <div style="background: #f5f5f5; padding: 12px; border-radius: 6px; font-size: 14px;" id="modalDemandedRepairs">
                    Loading...
                </div>
            </div>
            
            <div class="progress-section">
                <h4>Service Progress:</h4>
                <div class="large-progress-bar">
                    <div class="large-progress-fill" id="modalProgress" style="width: 0%;">0%</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Login functionality
        let pinCode = '';
        const correctPin = '1234'; // In production, this would be validated server-side

        function addDigit(digit) {
            if (pinCode.length < 4) {
                pinCode += digit;
                updatePinDisplay();
                
                if (pinCode.length === 4) {
                    validatePin();
                }
            }
        }

        function clearPin() {
            pinCode = '';
            updatePinDisplay();
            document.getElementById('loginError').textContent = '';
        }

        function updatePinDisplay() {
            const digits = document.querySelectorAll('.pin-digit');
            digits.forEach((digit, index) => {
                digit.value = pinCode[index] ? '•' : '';
                digit.classList.toggle('filled', pinCode[index]);
            });
        }

        function validatePin() {
            if (pinCode === correctPin) {
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainApp').style.display = 'block';
                init();
            } else {
                document.getElementById('loginError').textContent = 'Incorrect PIN. Please try again.';
                setTimeout(clearPin, 1500);
            }
        }

        function logout() {
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('loginScreen').classList.remove('hidden');
            clearPin();
        }

        // Mock data
        const mockVehicles = [
            { 
                id: 1, 
                number: 'MH12AB1234', 
                type: 'Paid Service', 
                waitTime: '25 min', 
                skills: ['General'], 
                priority: true, 
                customerWaiting: true,
                jobCardNo: 'JC-2024-1001',
                serviceAdvisor: 'Rajesh Kumar',
                estimatedDelivery: '2:30 PM',
                demandedRepairs: 'Noise from front suspension, Engine oil change',
                estimatedTime: 90,
                frt: 85,
                tags: ['CW', 'RR'] // Customer Waiting, Repeat Repair
            },
            { 
                id: 2, 
                number: 'MH14CD5678', 
                type: 'Free Service', 
                waitTime: '18 min', 
                skills: ['General'],
                jobCardNo: 'JC-2024-1002',
                serviceAdvisor: 'Amit Sharma',
                estimatedDelivery: '1:45 PM',
                demandedRepairs: '20,000 km service',
                estimatedTime: 60,
                frt: 60,
                tags: []
            },
            { 
                id: 3, 
                number: 'MH12EF9012', 
                type: 'Repair', 
                waitTime: '52 min', 
                skills: ['Suspension'],
                jobCardNo: 'JC-2024-1003',
                serviceAdvisor: 'Suresh Patil',
                estimatedDelivery: '4:00 PM',
                demandedRepairs: 'Clutch hard, Gear shifting issue',
                runningLate: true,
                estimatedTime: 120,
                frt: 110,
                tags: ['RR'] // Repeat Repair
            },
            { 
                id: 4, 
                number: 'MH14GH3456', 
                type: 'EV Service', 
                waitTime: '8 min', 
                skills: ['EV Certified'],
                jobCardNo: 'JC-2024-1004',
                serviceAdvisor: 'Priya Mehta',
                estimatedDelivery: '3:15 PM',
                demandedRepairs: 'Battery health check, Software update',
                isEV: true,
                estimatedTime: 45,
                frt: 45,
                tags: ['VIP'] // VIP customer
            },
            { 
                id: 5, 
                number: 'MH12IJ7890', 
                type: 'Accidental', 
                waitTime: '35 min', 
                skills: ['Body Shop'],
                jobCardNo: 'JC-2024-1005',
                serviceAdvisor: 'Vinod Singh',
                estimatedDelivery: '5:30 PM',
                demandedRepairs: 'Front bumper repair, Headlight replacement',
                accidental: true,
                estimatedTime: 180,
                frt: 150,
                tags: ['CW'] // Customer Waiting
            }
        ];

        const mockBays = [
            { 
                id: 1, 
                number: 'Bay 1', 
                status: 'occupied', 
                vehicle: 'MH12XY1111', 
                startTime: '9:00 AM', 
                progress: 75, 
                timeRemaining: '15 min', 
                skills: ['General'],
                vehicleData: {
                    jobCardNo: 'JC-2024-0991',
                    type: 'Paid Service',
                    serviceAdvisor: 'Rajesh Kumar',
                    estimatedDelivery: '11:00 AM',
                    demandedRepairs: 'Regular 40,000km service, AC filter replacement',
                    tags: ['CW']
                }
            },
            { 
                id: 2, 
                number: 'Bay 2', 
                status: 'occupied', 
                vehicle: 'MH14ZZ2222', 
                startTime: '9:30 AM', 
                progress: 40, 
                timeRemaining: '35 min', 
                skills: ['General'],
                vehicleData: {
                    jobCardNo: 'JC-2024-0992',
                    type: 'Repair',
                    serviceAdvisor: 'Amit Sharma',
                    estimatedDelivery: '12:00 PM',
                    demandedRepairs: 'Brake pad replacement, Wheel alignment',
                    tags: []
                }
            },
            { id: 3, number: 'Bay 3', status: 'empty', skills: ['General', 'Suspension'] },
            { 
                id: 4, 
                number: 'Bay 4', 
                status: 'finishing-soon', 
                vehicle: 'MH12AA3333', 
                startTime: '8:45 AM', 
                progress: 90, 
                timeRemaining: '5 min', 
                skills: ['General'],
                vehicleData: {
                    jobCardNo: 'JC-2024-0993',
                    type: 'Free Service',
                    serviceAdvisor: 'Priya Mehta',
                    estimatedDelivery: '10:45 AM',
                    demandedRepairs: 'First free service (5000km)',
                    tags: ['VIP']
                }
            },
            { id: 5, number: 'Bay 5', status: 'empty', skills: ['EV Certified'] },
            { 
                id: 6, 
                number: 'Bay 6', 
                status: 'occupied', 
                vehicle: 'MH14BB4444', 
                startTime: '10:00 AM', 
                progress: 60, 
                timeRemaining: '20 min', 
                skills: ['General'], 
                runningLate: true,
                vehicleData: {
                    jobCardNo: 'JC-2024-0994',
                    type: 'Repair',
                    serviceAdvisor: 'Suresh Patil',
                    estimatedDelivery: '1:00 PM',
                    demandedRepairs: 'Engine overheating issue, Coolant leak repair',
                    tags: ['RR', 'CW']
                }
            },
            { id: 7, number: 'Bay 7', status: 'empty', skills: ['General'] },
            { 
                id: 8, 
                number: 'Bay 8', 
                status: 'occupied', 
                vehicle: 'MH12CC5555', 
                startTime: '9:15 AM', 
                progress: 30, 
                timeRemaining: '40 min', 
                skills: ['Suspension'],
                vehicleData: {
                    jobCardNo: 'JC-2024-0995',
                    type: 'Repair',
                    serviceAdvisor: 'Vinod Singh',
                    estimatedDelivery: '12:30 PM',
                    demandedRepairs: 'Suspension noise, Shock absorber replacement',
                    tags: []
                }
            },
            { id: 9, number: 'Bay 9', status: 'empty', skills: ['Body Shop'] },
            { id: 10, number: 'Bay 10', status: 'empty', skills: ['General'] }
        ];

        // Initialize the application
        function init() {
            renderQueue();
            renderBayGrid();
            renderTimeline();
            startRealTimeUpdates();
            setupDragAndDrop();
            updateStats();
            
            // Show initial alerts
            setTimeout(() => {
                showAlert('warning', 'Bay 4 Finishing Soon', 'Vehicle MH12AA3333 will be completed in 5 minutes. Click to see recommended vehicles.', 'bay-finishing', () => showRecommendations(4));
            }, 2000);
            
            setTimeout(() => {
                showAlert('alert', 'Vehicle Running Late', 'MH12EF9012 is running 22 minutes behind schedule. Customer waiting.', 'vehicle-late');
            }, 4000);
            
            setTimeout(() => {
                showAlert('info', 'Bay 6 Needs Attention', 'Vehicle MH14BB4444 experiencing delays. Check with technician.', 'bay-attention');
            }, 6000);
        }

        // Render vehicle queue
        function renderQueue() {
            const queueList = document.getElementById('queueList');
            queueList.innerHTML = '';
            
            mockVehicles.forEach(vehicle => {
                const card = createVehicleCard(vehicle);
                queueList.appendChild(card);
            });
            
            document.getElementById('queueCount').textContent = mockVehicles.length;
            document.getElementById('pendingVehicles').textContent = mockVehicles.length;
        }

        // Create vehicle card element
        function createVehicleCard(vehicle) {
            const card = document.createElement('div');
            card.className = 'vehicle-card';
            if (vehicle.priority) card.classList.add('priority');
            if (vehicle.customerWaiting) card.classList.add('waiting-customer');
            if (vehicle.runningLate) card.classList.add('running-late');
            if (vehicle.tags && vehicle.tags.includes('VIP')) card.classList.add('vip');
            
            card.draggable = true;
            card.dataset.vehicleId = vehicle.id;
            
            // Create priority tags HTML
            let tagsHtml = '';
            if (vehicle.tags && vehicle.tags.length > 0) {
                tagsHtml = '<div class="priority-tags" style="margin-bottom: 8px;">';
                vehicle.tags.forEach(tag => {
                    switch(tag) {
                        case 'RR':
                            tagsHtml += '<span class="priority-tag rr">🔄 RR</span>';
                            break;
                        case 'CW':
                            tagsHtml += '<span class="priority-tag cw">👤 CW</span>';
                            break;
                        case 'VIP':
                            tagsHtml += '<span class="priority-tag vip">⭐ VIP</span>';
                            break;
                    }
                });
                tagsHtml += '</div>';
            }
            
            card.innerHTML = `
                ${tagsHtml}
                <div class="vehicle-info">
                    <div class="vehicle-number">${vehicle.number}</div>
                    <div class="wait-time ${vehicle.runningLate ? 'late' : ''}">⏱ ${vehicle.waitTime}</div>
                </div>
                <div class="vehicle-details">
                    <div class="detail-chip">${vehicle.type}</div>
                    ${vehicle.skills.map(skill => 
                        `<div class="detail-chip skill-required">🔧 ${skill}</div>`
                    ).join('')}
                    ${vehicle.isEV ? '<div class="detail-chip" style="background: #e8f5e9; color: #2e7d32;">⚡ EV</div>' : ''}
                    ${vehicle.runningLate ? '<div class="detail-chip" style="background: #ffcdd2; color: #c62828;">⚠️ Running Late</div>' : ''}
                </div>
                <div class="job-card-info">
                    <div class="job-card-row">
                        <span>Job Card:</span>
                        <a href="#" class="job-card-link" onclick="openJobCard('${vehicle.jobCardNo}')">${vehicle.jobCardNo}</a>
                    </div>
                    <div class="job-card-row">
                        <span>Advisor:</span>
                        <span>${vehicle.serviceAdvisor}</span>
                    </div>
                    <div class="job-card-row">
                        <span>Est. Delivery:</span>
                        <span style="color: ${vehicle.runningLate ? '#c62828' : '#333'};">${vehicle.estimatedDelivery}</span>
                    </div>
                    <div class="demanded-repairs">
                        <strong>Repairs:</strong> ${vehicle.demandedRepairs}
                    </div>
                </div>
            `;
            
            return card;
        }

        // Render bay grid
        function renderBayGrid() {
            const bayGrid = document.getElementById('bayGrid');
            bayGrid.innerHTML = '';
            
            mockBays.forEach(bay => {
                const bayCard = createBayCard(bay);
                bayGrid.appendChild(bayCard);
            });
        }

        // Create bay card element
        function createBayCard(bay) {
            const card = document.createElement('div');
            card.className = `bay-card ${bay.status}`;
            if (bay.runningLate) card.classList.add('needs-attention');
            card.dataset.bayId = bay.id;
            
            let content = '';
            
            if (bay.status === 'empty') {
                content = `
                    <div class="bay-header">
                        <div class="bay-number">${bay.number}</div>
                        <div class="bay-status-indicator"></div>
                    </div>
                    <div class="bay-content">
                        <div class="empty-state">Click to see recommended vehicles</div>
                        <div class="recommended-vehicles">
                            <strong>Skills:</strong> ${bay.skills.join(', ')}
                        </div>
                    </div>
                `;
            } else {
                const progressClass = bay.runningLate ? 'alert' : bay.progress > 80 ? 'warning' : '';
                
                // Create priority tags for occupied bays
                let bayTagsHtml = '';
                if (bay.vehicleData && bay.vehicleData.tags && bay.vehicleData.tags.length > 0) {
                    bayTagsHtml = '<div class="priority-tags" style="margin-bottom: 8px; justify-content: center;">';
                    bay.vehicleData.tags.forEach(tag => {
                        switch(tag) {
                            case 'RR':
                                bayTagsHtml += '<span class="priority-tag rr" style="font-size: 11px; padding: 3px 8px;">🔄 RR</span>';
                                break;
                            case 'CW':
                                bayTagsHtml += '<span class="priority-tag cw" style="font-size: 11px; padding: 3px 8px;">👤 CW</span>';
                                break;
                            case 'VIP':
                                bayTagsHtml += '<span class="priority-tag vip" style="font-size: 11px; padding: 3px 8px;">⭐ VIP</span>';
                                break;
                        }
                    });
                    bayTagsHtml += '</div>';
                }
                
                content = `
                    <div class="bay-header">
                        <div class="bay-number">${bay.number}</div>
                        <div class="bay-status-indicator occupied ${bay.runningLate ? 'alert' : ''}"></div>
                    </div>
                    <div class="bay-content">
                        <div class="bay-vehicle">
                            <div class="vehicle-number">${bay.vehicle}</div>
                            ${bayTagsHtml}
                            <div class="progress-bar">
                                <div class="progress-fill ${progressClass}" style="width: ${bay.progress}%"></div>
                            </div>
                            <div class="time-info">
                                <span>Started: ${bay.startTime}</span>
                                <span>${bay.timeRemaining} left</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            card.innerHTML = content;
            
            // Add click handler
            card.addEventListener('click', () => {
                if (bay.status === 'empty') {
                    showRecommendations(bay.id);
                } else {
                    showVehicleDetails(bay);
                }
            });
            
            return card;
        }

        // Show vehicle details modal
        function showVehicleDetails(bay) {
            const modal = document.getElementById('vehicleDetailsModal');
            const overlay = document.getElementById('modalOverlay');
            
            // Set vehicle number
            document.getElementById('modalVehicleNumber').textContent = bay.vehicle;
            
            // Set priority tags
            const tagsContainer = document.getElementById('modalPriorityTags');
            tagsContainer.innerHTML = '';
            if (bay.vehicleData && bay.vehicleData.tags && bay.vehicleData.tags.length > 0) {
                bay.vehicleData.tags.forEach(tag => {
                    let tagHtml = '';
                    switch(tag) {
                        case 'RR':
                            tagHtml = '<span class="priority-tag rr">🔄 Repeat Repair</span>';
                            break;
                        case 'CW':
                            tagHtml = '<span class="priority-tag cw">👤 Customer Waiting</span>';
                            break;
                        case 'VIP':
                            tagHtml = '<span class="priority-tag vip">⭐ VIP Customer</span>';
                            break;
                    }
                    tagsContainer.innerHTML += tagHtml;
                });
            }
            
            // Set details
            if (bay.vehicleData) {
                document.getElementById('modalJobCard').textContent = bay.vehicleData.jobCardNo;
                document.getElementById('modalJobCard').onclick = () => openJobCard(bay.vehicleData.jobCardNo);
                document.getElementById('modalServiceType').textContent = bay.vehicleData.type;
                document.getElementById('modalAdvisor').textContent = bay.vehicleData.serviceAdvisor;
                document.getElementById('modalDemandedRepairs').textContent = bay.vehicleData.demandedRepairs;
                document.getElementById('modalEstDelivery').textContent = bay.vehicleData.estimatedDelivery;
            }
            
            document.getElementById('modalBay').textContent = bay.number;
            document.getElementById('modalStartTime').textContent = bay.startTime;
            document.getElementById('modalTimeRemaining').textContent = bay.timeRemaining;
            
            // Set progress
            const progressBar = document.getElementById('modalProgress');
            progressBar.style.width = bay.progress + '%';
            progressBar.textContent = bay.progress + '%';
            
            if (bay.progress > 80) {
                progressBar.style.background = '#ff9800';
            } else if (bay.runningLate) {
                progressBar.style.background = '#f44336';
            } else {
                progressBar.style.background = '#4caf50';
            }
            
            modal.classList.add('active');
            overlay.classList.add('active');
        }

        // Show recommendations modal
        function showRecommendations(bayId) {
            const bay = mockBays.find(b => b.id == bayId);
            const modal = document.getElementById('recommendationModal');
            const overlay = document.getElementById('modalOverlay');
            
            document.getElementById('modalBayNumber').textContent = bay.number;
            
            // Calculate recommendations based on algorithm
            const recommendations = calculateRecommendations(bay);
            
            const listHtml = recommendations.map((rec, index) => {
                // Create tags HTML for recommendations
                let recTagsHtml = '';
                if (rec.vehicle.tags && rec.vehicle.tags.length > 0) {
                    recTagsHtml = '<div class="priority-tags" style="margin-top: 8px;">';
                    rec.vehicle.tags.forEach(tag => {
                        switch(tag) {
                            case 'RR':
                                recTagsHtml += '<span class="priority-tag rr" style="font-size: 11px; padding: 3px 8px;">🔄 RR</span>';
                                break;
                            case 'CW':
                                recTagsHtml += '<span class="priority-tag cw" style="font-size: 11px; padding: 3px 8px;">👤 CW</span>';
                                break;
                            case 'VIP':
                                recTagsHtml += '<span class="priority-tag vip" style="font-size: 11px; padding: 3px 8px;">⭐ VIP</span>';
                                break;
                        }
                    });
                    recTagsHtml += '</div>';
                }
                
                return `
                    <div class="recommendation-item ${index === 0 ? 'best' : ''}" onclick="allocateRecommendation(${rec.vehicle.id}, ${bayId})">
                        <div class="recommendation-score">
                            <div>
                                <strong>${rec.vehicle.number}</strong> - ${rec.vehicle.type}
                                ${recTagsHtml}
                            </div>
                            <span class="score-badge">${rec.score}% Match</span>
                        </div>
                        <div class="recommendation-details">
                            <div>Wait Time: ${rec.vehicle.waitTime}</div>
                            <div>FRT: ${rec.vehicle.frt} min</div>
                            <div>Skills: ${rec.vehicle.skills.join(', ')}</div>
                            ${rec.reasons.map(r => `<div>✓ ${r}</div>`).join('')}
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('recommendationList').innerHTML = listHtml;
            
            modal.classList.add('active');
            overlay.classList.add('active');
        }

        // Calculate recommendations
        function calculateRecommendations(bay) {
            const recommendations = [];
            
            mockVehicles.forEach(vehicle => {
                let score = 0;
                const reasons = [];
                
                // Skill match (30 points)
                const skillMatch = vehicle.skills.every(skill => bay.skills.includes(skill));
                if (skillMatch) {
                    score += 30;
                    reasons.push('Skills match perfectly');
                }
                
                // Priority tags (30 points total)
                if (vehicle.tags && vehicle.tags.includes('VIP')) {
                    score += 15;
                    reasons.push('VIP customer priority');
                }
                if (vehicle.tags && vehicle.tags.includes('RR')) {
                    score += 10;
                    reasons.push('Repeat repair - needs attention');
                }
                if (vehicle.tags && vehicle.tags.includes('CW')) {
                    score += 5;
                    reasons.push('Customer waiting in lounge');
                }
                
                // Wait time priority (25 points)
                const waitMinutes = parseInt(vehicle.waitTime);
                if (waitMinutes > 30) {
                    score += 25;
                    reasons.push('High priority - long wait time');
                } else if (waitMinutes > 20) {
                    score += 15;
                    reasons.push('Medium wait time');
                } else {
                    score += 5;
                }
                
                // FRT optimization (15 points)
                if (vehicle.frt <= 60) {
                    score += 15;
                    reasons.push('Quick service - optimal for flow');
                } else if (vehicle.frt <= 90) {
                    score += 10;
                    reasons.push('Standard service time');
                } else {
                    score += 5;
                }
                
                recommendations.push({
                    vehicle,
                    score,
                    reasons
                });
            });
            
            return recommendations.sort((a, b) => b.score - a.score);
        }

        // Close modal
        function closeModal() {
            document.getElementById('recommendationModal').classList.remove('active');
            document.getElementById('vehicleDetailsModal').classList.remove('active');
            document.getElementById('modalOverlay').classList.remove('active');
        }

        // Close recommendation modal (kept for backward compatibility)
        function closeRecommendationModal() {
            closeModal();
        }

        // Allocate from recommendation
        function allocateRecommendation(vehicleId, bayId) {
            closeModal();
            proceedWithAllocation(vehicleId, bayId);
        }

        // Render timeline view
        function renderTimeline() {
            const timelineBody = document.getElementById('timelineBody');
            timelineBody.innerHTML = '';
            
            mockBays.forEach(bay => {
                const row = document.createElement('div');
                row.className = 'timeline-row';
                
                row.innerHTML = `
                    <div class="bay-label">${bay.number}</div>
                    <div class="timeline-slots">
                        ${Array(12).fill('').map((_, i) => `<div class="timeline-slot"></div>`).join('')}
                    </div>
                `;
                
                timelineBody.appendChild(row);
                
                // Add vehicles to timeline
                if (bay.status !== 'empty') {
                    const vehicleEl = createTimelineVehicle(bay);
                    row.querySelector('.timeline-slots').appendChild(vehicleEl);
                }
            });
            
            // Add current time indicator
            updateTimeIndicator();
        }

        // Create timeline vehicle element
        function createTimelineVehicle(bay) {
            const vehicle = document.createElement('div');
            vehicle.className = 'timeline-vehicle';
            
            if (bay.runningLate) vehicle.classList.add('late');
            if (bay.progress > 80) vehicle.classList.add('finishing');
            
            // Calculate position based on start time and duration
            const startHour = parseInt(bay.startTime.split(':')[0]);
            const startMinute = parseInt(bay.startTime.split(':')[1]);
            const startOffset = ((startHour - 8) * 60 + startMinute) / 60;
            
            const duration = parseInt(bay.timeRemaining) / 60 + (bay.progress / 100 * 2);
            
            vehicle.style.left = `${startOffset * 8.33}%`;
            vehicle.style.width = `${duration * 8.33}%`;
            
            vehicle.innerHTML = `
                <div style="font-weight: 600;">${bay.vehicle}</div>
                <div style="font-size: 11px;">${bay.progress}% complete</div>
            `;
            
            return vehicle;
        }

        // Update time indicator
        function updateTimeIndicator() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const offset = ((hours - 8) * 60 + minutes) / 60;
            
            let indicator = document.querySelector('.current-time-indicator');
            if (!indicator) {
                indicator = document.createElement('div');
                indicator.className = 'current-time-indicator';
                document.querySelector('.timeline-slots')?.appendChild(indicator);
            }
            
            indicator.style.left = `${offset * 8.33}%`;
        }

        // Setup drag and drop
        function setupDragAndDrop() {
            let draggedElement = null;
            
            document.addEventListener('dragstart', (e) => {
                if (e.target.classList.contains('vehicle-card')) {
                    draggedElement = e.target;
                    e.target.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                }
            });
            
            document.addEventListener('dragend', (e) => {
                if (e.target.classList.contains('vehicle-card')) {
                    e.target.classList.remove('dragging');
                }
            });
            
            document.addEventListener('dragover', (e) => {
                if (e.target.closest('.bay-card.empty')) {
                    e.preventDefault();
                    e.target.closest('.bay-card').classList.add('drag-over');
                }
            });
            
            document.addEventListener('dragleave', (e) => {
                if (e.target.closest('.bay-card')) {
                    e.target.closest('.bay-card').classList.remove('drag-over');
                }
            });
            
            document.addEventListener('drop', (e) => {
                const bayCard = e.target.closest('.bay-card.empty');
                if (bayCard && draggedElement) {
                    e.preventDefault();
                    bayCard.classList.remove('drag-over');
                    
                    const vehicleId = draggedElement.dataset.vehicleId;
                    const bayId = bayCard.dataset.bayId;
                    
                    allocateVehicleToBay(vehicleId, bayId);
                }
            });
        }

        // Allocate vehicle to bay
        function allocateVehicleToBay(vehicleId, bayId) {
            const vehicle = mockVehicles.find(v => v.id == vehicleId);
            const bay = mockBays.find(b => b.id == bayId);
            
            if (vehicle && bay) {
                const hasRequiredSkills = vehicle.skills.every(skill => 
                    bay.skills.includes(skill)
                );
                
                if (!hasRequiredSkills && vehicle.skills[0] !== 'General') {
                    showAlert('warning', 'Skill Mismatch', 
                        `Bay ${bay.number} doesn't have required skills for this vehicle. Continue anyway?`, 
                        'skill-mismatch',
                        () => proceedWithAllocation(vehicleId, bayId),
                        () => {}
                    );
                } else {
                    proceedWithAllocation(vehicleId, bayId);
                }
            }
        }

        // Proceed with allocation
        function proceedWithAllocation(vehicleId, bayId) {
            const vehicle = mockVehicles.find(v => v.id == vehicleId);
            const bay = mockBays.find(b => b.id == bayId);
            
            // Update bay status
            bay.status = 'occupied';
            bay.vehicle = vehicle.number;
            bay.progress = 0;
            bay.timeRemaining = vehicle.estimatedTime + ' min';
            bay.startTime = new Date().toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit',
                hour12: true 
            });
            
            // Add vehicle data to bay
            bay.vehicleData = {
                jobCardNo: vehicle.jobCardNo,
                type: vehicle.type,
                serviceAdvisor: vehicle.serviceAdvisor,
                estimatedDelivery: vehicle.estimatedDelivery,
                demandedRepairs: vehicle.demandedRepairs,
                tags: vehicle.tags || []
            };
            
            // Remove vehicle from queue
            const index = mockVehicles.findIndex(v => v.id == vehicleId);
            mockVehicles.splice(index, 1);
            
            // Re-render
            renderQueue();
            renderBayGrid();
            renderTimeline();
            
            // Show success notification
            showAlert('info', 'Vehicle Allocated', 
                `${vehicle.number} has been allocated to ${bay.number}`, 
                'allocation-success'
            );
            
            // Update stats
            updateStats();
        }

        // Show alert
        function showAlert(type, title, message, id, onConfirm, onCancel) {
            const alertsPanel = document.getElementById('alertsPanel');
            
            const alert = document.createElement('div');
            alert.className = `alert-item ${type}`;
            alert.id = `alert-${id}`;
            
            alert.innerHTML = `
                <div class="alert-header">
                    <div class="alert-title">${title}</div>
                    <span class="alert-close" onclick="closeAlert('${id}')">&times;</span>
                </div>
                <div class="alert-message">${message}</div>
                ${onConfirm ? `
                    <div class="alert-actions">
                        <button class="alert-btn primary" onclick="handleAlertAction('${id}', true)">Proceed</button>
                        <button class="alert-btn secondary" onclick="handleAlertAction('${id}', false)">Cancel</button>
                    </div>
                ` : ''}
            `;
            
            alertsPanel.appendChild(alert);
            
            if (onConfirm) {
                alert.onConfirm = onConfirm;
                alert.onCancel = onCancel;
            }
            
            if (!onConfirm) {
                setTimeout(() => closeAlert(id), 10000);
            }
        }

        // Handle alert action
        function handleAlertAction(id, confirm) {
            const alert = document.getElementById(`alert-${id}`);
            if (alert) {
                if (confirm && alert.onConfirm) {
                    alert.onConfirm();
                } else if (!confirm && alert.onCancel) {
                    alert.onCancel();
                }
                closeAlert(id);
            }
        }

        // Close alert
        function closeAlert(id) {
            const alert = document.getElementById(`alert-${id}`);
            if (alert) {
                alert.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => alert.remove(), 300);
            }
        }

        // Open job card PDF
        function openJobCard(jobCardNo) {
            console.log('Opening job card:', jobCardNo);
            // In production, this would open the PDF viewer
            alert(`Opening job card ${jobCardNo} (PDF viewer would open in production)`);
        }

        // Update stats
        function updateStats() {
            const totalBays = mockBays.length;
            const occupiedBays = mockBays.filter(b => b.status !== 'empty').length;
            const utilization = Math.round((occupiedBays / totalBays) * 100);
            
            const needsAttention = mockBays.filter(b => b.runningLate).length + 
                                   mockVehicles.filter(v => v.runningLate).length;
            
            document.getElementById('vehiclesInShop').textContent = occupiedBays;
            document.getElementById('baysUtilization').textContent = utilization + '%';
            document.getElementById('needsAttention').textContent = needsAttention;
        }

        // Start real-time updates
        function startRealTimeUpdates() {
            setInterval(() => {
                const now = new Date();
                const time = now.toLocaleTimeString('en-US', { 
                    hour: 'numeric', 
                    minute: '2-digit',
                    hour12: true 
                });
                document.getElementById('currentTime').textContent = time;
                
                // Update progress bars
                mockBays.forEach(bay => {
                    if (bay.status === 'occupied' || bay.status === 'finishing-soon') {
                        bay.progress = Math.min(bay.progress + 0.5, 100);
                        
                        // Check if finishing soon
                        if (bay.progress >= 85 && bay.status === 'occupied') {
                            bay.status = 'finishing-soon';
                            renderBayGrid();
                        }
                    }
                });
                
                // Update wait times
                mockVehicles.forEach(vehicle => {
                    const waitMinutes = parseInt(vehicle.waitTime);
                    vehicle.waitTime = (waitMinutes + 1) + ' min';
                });
                
                // Update timeline indicator
                if (document.getElementById('timelineView').classList.contains('active')) {
                    updateTimeIndicator();
                }
                
                // Refresh every minute
                if (now.getSeconds() === 0) {
                    renderQueue();
                    renderBayGrid();
                    updateStats();
                }
            }, 1000);
        }

        // Set view
        function setView(view) {
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            if (view === 'grid') {
                document.getElementById('bayGrid').classList.remove('hidden');
                document.getElementById('timelineView').classList.remove('active');
            } else {
                document.getElementById('bayGrid').classList.add('hidden');
                document.getElementById('timelineView').classList.add('active');
                renderTimeline();
            }
        }
    </script>
</body>
</html>